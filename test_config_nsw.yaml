# Kanyo configuration - NSW Falcon Cam Test
# Override any value with env var: KANYO_<KEY> (e.g., KANYO_VIDEO_SOURCE)

# ─────────────────────────────────────────────────────────────────────────────
# Stream & Detection
# ─────────────────────────────────────────────────────────────────────────────
video_source: "https://www.youtube.com/watch?v=yv2RtoIMNzA"  # NSW Falcon Cam
detection_confidence: 0.5      # 0.0–1.0, higher = fewer false positives
detection_interval: 60         # seconds between detection runs (for notifications)
frame_interval: 30             # process every Nth frame (30 = 2fps at 60fps source)
model_path: "models/yolov8n.pt"
detect_any_animal: true        # treat any animal as "falcon" (model misclassifies)
exit_timeout: 60               # seconds of no detection before falcon "left" (using debounce)
visit_merge_timeout: 60        # merge visits if re-enter within N seconds (debounce)

# COCO class IDs to detect when detect_any_animal is true
# Model often misclassifies falcons as: bird(14), cat(15), dog(16)
animal_classes:
  - 14  # bird
  - 15  # cat
  - 16  # dog
  - 17  # horse
  - 18  # sheep
  - 19  # cow
  - 20  # elephant
  - 21  # bear
  - 22  # zebra
  - 23  # giraffe

# ─────────────────────────────────────────────────────────────────────────────
# Clip Extraction & Storage
# ─────────────────────────────────────────────────────────────────────────────
clips_dir: "clips"             # where to save clips and thumbnails (organized by date)
clip_entrance_before: 5       # seconds before entrance to include
clip_entrance_after: 15        # seconds after entrance to include
clip_exit_before: 15           # seconds before exit to include
clip_exit_after: 5            # seconds after exit to include
clip_merge_threshold: 180      # merge into one clip if events within N seconds

# Thumbnail settings (one per event)
thumbnail_entrance_offset: 5   # seconds after entrance to capture thumbnail
thumbnail_exit_offset: -10     # seconds before exit (negative = before event)

# Compression settings
clip_compress: true            # re-encode for smaller files (~10x smaller)
clip_crf: 23                   # quality: 18=high/larger, 23=balanced, 28=low/smaller
clip_fps: 30                   # output framerate (30 is fine for playback)

# Hardware encoding (GPU acceleration) - see docs/hardware-encoding.md
clip_hardware_encoding: true   # true=auto-detect GPU, false=use software (libx264)
# clip_encoder: auto           # override: h264_videotoolbox, h264_nvenc, h264_vaapi, libx264

# ─────────────────────────────────────────────────────────────────────────────
# Live Stream Ingestion (YouTube) - TEST CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────
live_use_ffmpeg_tee: true      # use ffmpeg tee to proxy+record YouTube live streams
live_proxy_url: "udp://127.0.0.1:12345"  # local proxy URL for detection
buffer_dir: "/tmp/kanyo-test-buffer"  # where segment recorder writes rolling buffer
continuous_chunk_minutes: 2    # shorter segments for testing (2 minutes)
max_runtime_seconds: 300       # 5 minute test duration

# ─────────────────────────────────────────────────────────────────────────────
# Logging
# ─────────────────────────────────────────────────────────────────────────────
log_level: "INFO"              # DEBUG, INFO, WARNING, ERROR, CRITICAL
log_file: "logs/kanyo.log"

# ─────────────────────────────────────────────────────────────────────────────
# Notifications (optional)
# ─────────────────────────────────────────────────────────────────────────────
ntfy_enabled: true
ntfy_topic: "kanyo_falcon_cam_test_nsw"  # Test topic
notification_cooldown_minutes: 5
