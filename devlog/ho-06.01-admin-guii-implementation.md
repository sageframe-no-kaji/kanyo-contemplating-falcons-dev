# Ho 6.1: Admin GUI Implementation

**Date:** 2025-12-27 **Status:** Ready to Build **Prerequisite:** [[ho-06-gui-architecture-planning]](architecture decisions) **Objective:** Build working Admin UI for stream management

---
## Overview

This Ho delivers a fully functional Admin interface that lets you:

- See all streams at a glance
- Edit configurations
- Restart containers
- Browse clips and logs

**Time Estimate:** 3-4 hours **Tech Stack:** FastAPI + Jinja2 + HTMX + Tailwind CSS

---

## Part 1: Technology Deep Dive

### Why FastAPI?

FastAPI is a modern Python web framework that's perfect for this use case:

```python
from fastapi import FastAPI
app = FastAPI()

@app.get("/api/streams")
async def list_streams():
    return {"streams": [...]}
```

**Key Benefits:**

1. **Async native** - Log streaming via WebSockets is trivial
2. **Type hints** - Pydantic models catch errors early
3. **Auto-docs** - `/docs` gives you Swagger UI for free
4. **Python ecosystem** - Docker SDK, PyYAML, etc. just work
5. **Fast** - Performance comparable to Node.js/Go

**Why not Flask?** Flask is synchronous by default. Log tailing and Docker operations benefit from async.

**Why not Django?** Overkill. Django's ORM and admin aren't needed for this ops tool.

### Why Jinja2 Templates?

Jinja2 is a templating engine that generates HTML on the server:

```html
<!-- templates/overview.html -->
{% for stream in streams %}
  <div class="stream-card">
    <h3>{{ stream.name }}</h3>
    <span class="status {{ stream.status }}">{{ stream.status }}</span>
  </div>
{% endfor %}
```

**Key Benefits:**

1. **No build step** - Edit template, refresh browser, see changes
2. **Server-side rendering** - Works without JavaScript
3. **Familiar** - If you've used any templating, Jinja2 is similar
4. **FastAPI integration** - First-class support via `Jinja2Templates`

**Why not React for Admin?** React requires a build step and adds complexity for what is essentially a forms-based UI. Config editing, log viewing, and container management don't need SPA interactivity.

### Why HTMX?

HTMX lets you add AJAX behavior with HTML attributes:

```html
<!-- Without HTMX: Page reload -->
<form action="/streams/harvard/restart" method="POST">
  <button type="submit">Restart</button>
</form>

<!-- With HTMX: Partial update, no reload -->
<button hx-post="/api/streams/harvard/restart" 
        hx-target="#harvard-status"
        hx-swap="innerHTML"
        hx-indicator="#loading">
  Restart
</button>
```

**Key Benefits:**

1. **SPA-like feel** without JavaScript framework
2. **Progressive enhancement** - Works without JS, better with it
3. **Small** - 14KB minified
4. **Server-driven** - Logic stays in Python, not JavaScript

**Core HTMX Attributes:**

- `hx-get`, `hx-post`, `hx-put`, `hx-delete` - HTTP methods
- `hx-target` - Where to put the response
- `hx-swap` - How to insert (innerHTML, outerHTML, beforeend, etc.)
- `hx-trigger` - When to fire (click, change, every 2s, etc.)
- `hx-indicator` - Loading spinner element

### Why Tailwind CSS?

Tailwind provides utility classes for styling:

```html
<!-- Traditional CSS -->
<div class="stream-card">...</div>
<style>
.stream-card {
  padding: 1rem;
  background: #2d2d2d;
  border-radius: 0.5rem;
}
</style>

<!-- Tailwind -->
<div class="p-4 bg-zinc-800 rounded-lg">...</div>
```

**Key Benefits:**

1. **No CSS files to manage** - Styles are in the HTML
2. **Consistent design** - Predefined spacing, colors, etc.
3. **Responsive** - `md:`, `lg:` prefixes for breakpoints
4. **Dark mode** - `dark:` prefix (we'll use dark by default)

**For Admin UI:** We'll use Tailwind via CDN (no build step):

```html
<script src="https://cdn.tailwindcss.com"></script>
```

---

## Part 2: Project Structure

```
kanyo-admin/
â”œâ”€â”€ docker-compose.yml          # Add admin service here
â”œâ”€â”€ .env                        # Stream paths
â”‚
â””â”€â”€ web/
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ requirements.txt
    â”œâ”€â”€ streams.yaml            # Stream registry
    â”‚
    â””â”€â”€ app/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ main.py             # FastAPI app
        â”œâ”€â”€ config.py           # Settings
        â”‚
        â”œâ”€â”€ routers/
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â”œâ”€â”€ api.py          # JSON API endpoints
        â”‚   â””â”€â”€ pages.py        # HTML page routes
        â”‚
        â”œâ”€â”€ services/
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â”œâ”€â”€ docker_service.py
        â”‚   â”œâ”€â”€ config_service.py
        â”‚   â”œâ”€â”€ clip_service.py
        â”‚   â””â”€â”€ stream_service.py
        â”‚
        â”œâ”€â”€ templates/
        â”‚   â”œâ”€â”€ base.html
        â”‚   â”œâ”€â”€ overview.html
        â”‚   â”œâ”€â”€ stream/
        â”‚   â”‚   â”œâ”€â”€ detail.html
        â”‚   â”‚   â”œâ”€â”€ config.html
        â”‚   â”‚   â””â”€â”€ logs.html
        â”‚   â””â”€â”€ components/
        â”‚       â”œâ”€â”€ stream_card.html
        â”‚       â”œâ”€â”€ clip_grid.html
        â”‚       â”œâ”€â”€ event_list.html
        â”‚       â”œâ”€â”€ config_form.html
        â”‚       â””â”€â”€ log_viewer.html
        â”‚
        â””â”€â”€ static/
            â”œâ”€â”€ css/
            â”‚   â””â”€â”€ custom.css      # Minimal custom styles
            â””â”€â”€ js/
                â””â”€â”€ app.js          # Minimal custom JS
```

---

## Part 3: Detailed Wireframes

### Overview Page (`/`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  ğŸ¦… KANYO ADMIN                                      shingan.lan     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   STREAMS                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                                â”‚  â”‚                                â”‚    â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚   â”‚  â”‚                          â”‚  â”‚  â”‚  â”‚                          â”‚  â”‚    â”‚
â”‚   â”‚  â”‚    [Latest Thumbnail]    â”‚  â”‚  â”‚  â”‚    [Latest Thumbnail]    â”‚  â”‚    â”‚
â”‚   â”‚  â”‚                          â”‚  â”‚  â”‚  â”‚                          â”‚  â”‚    â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚   â”‚                                â”‚  â”‚                                â”‚    â”‚
â”‚   â”‚  Harvard Peregrine Cam         â”‚  â”‚  NSW Falcon Cam                â”‚    â”‚
â”‚   â”‚  ğŸŸ¢ Running                    â”‚  â”‚  ğŸŸ¢ Running                    â”‚    â”‚
â”‚   â”‚                                â”‚  â”‚                                â”‚    â”‚
â”‚   â”‚  Today: 5 visits               â”‚  â”‚  Today: 2 visits               â”‚    â”‚
â”‚   â”‚  Last event: 2h ago (depart)   â”‚  â”‚  Last event: 30m ago (arrive)  â”‚    â”‚
â”‚   â”‚                                â”‚  â”‚                                â”‚    â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚    â”‚
â”‚   â”‚  â”‚ View   â”‚ â”‚ Config â”‚ â”‚ âŸ³  â”‚  â”‚  â”‚  â”‚ View   â”‚ â”‚ Config â”‚ â”‚ âŸ³  â”‚  â”‚    â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚   â”‚                                â”‚  â”‚                                â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚   â”‚  + Add Stream                  â”‚                                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚   SYSTEM STATUS                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  GPU: NVIDIA RTX 3050  â”‚  325 MB / 8192 MB  â”‚  0% util              â”‚  â”‚
â”‚   â”‚  Containers: 2 running â”‚  Uptime: 9h 23m    â”‚  Disk: 45 GB used     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**HTML Structure:**

```html
<div class="min-h-screen bg-zinc-900 text-white p-6">
  <!-- Header -->
  <header class="flex justify-between items-center mb-8">
    <h1 class="text-2xl font-bold flex items-center gap-2">
      ğŸ¦… KANYO ADMIN
    </h1>
    <span class="text-zinc-400">shingan.lan</span>
  </header>

  <!-- Stream Grid -->
  <section class="mb-8">
    <h2 class="text-lg font-semibold mb-4 text-zinc-300">STREAMS</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for stream in streams %}
        {% include "components/stream_card.html" %}
      {% endfor %}
      <!-- Add Stream Card -->
      <div class="border-2 border-dashed border-zinc-700 rounded-lg p-6 
                  flex items-center justify-center cursor-pointer
                  hover:border-zinc-500 transition-colors">
        <span class="text-zinc-500">+ Add Stream</span>
      </div>
    </div>
  </section>

  <!-- System Status -->
  <section>
    <h2 class="text-lg font-semibold mb-4 text-zinc-300">SYSTEM STATUS</h2>
    <div class="bg-zinc-800 rounded-lg p-4">
      <!-- GPU, containers, disk info -->
    </div>
  </section>
</div>
```

---

### Stream Card Component

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚    [Thumbnail: 16:9 ratio]   â”‚  â”‚  â† Latest clip thumbnail or
â”‚  â”‚                              â”‚  â”‚    placeholder if no clips
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚
â”‚  Harvard Peregrine Cam             â”‚  â† Stream name
â”‚  ğŸŸ¢ Running         9h 23m         â”‚  â† Status dot + uptime
â”‚                                    â”‚
â”‚  Today: 5 visits                   â”‚  â† Activity summary
â”‚  Last: 2h ago (departure)          â”‚  â† Most recent event
â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚
â”‚  â”‚  View    â”‚ â”‚  Config  â”‚ â”‚ âŸ³  â”‚  â”‚  â† Action buttons
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Jinja2 Template (`components/stream_card.html`):**

```html
<div class="bg-zinc-800 rounded-lg overflow-hidden" id="stream-{{ stream.id }}">
  <!-- Thumbnail -->
  <div class="aspect-video bg-zinc-700 relative">
    {% if stream.thumbnail %}
      <img src="{{ stream.thumbnail }}" alt="{{ stream.name }}" 
           class="w-full h-full object-cover">
    {% else %}
      <div class="absolute inset-0 flex items-center justify-center text-zinc-500">
        No recent clips
      </div>
    {% endif %}
  </div>
  
  <!-- Info -->
  <div class="p-4">
    <h3 class="font-semibold text-lg">{{ stream.name }}</h3>
    
    <div class="flex items-center gap-2 mt-1 text-sm">
      <span class="w-2 h-2 rounded-full 
        {% if stream.status == 'running' %}bg-green-500
        {% elif stream.status == 'stopped' %}bg-red-500
        {% else %}bg-yellow-500{% endif %}">
      </span>
      <span class="text-zinc-400 capitalize">{{ stream.status }}</span>
      {% if stream.uptime %}
        <span class="text-zinc-500">{{ stream.uptime }}</span>
      {% endif %}
    </div>
    
    <div class="mt-3 text-sm text-zinc-400">
      <div>Today: {{ stream.today_visits }} visits</div>
      <div>Last: {{ stream.last_event_ago }} ({{ stream.last_event_type }})</div>
    </div>
    
    <!-- Actions -->
    <div class="flex gap-2 mt-4">
      <a href="/streams/{{ stream.id }}" 
         class="flex-1 bg-zinc-700 hover:bg-zinc-600 text-center py-2 rounded text-sm">
        View
      </a>
      <a href="/streams/{{ stream.id }}/config" 
         class="flex-1 bg-zinc-700 hover:bg-zinc-600 text-center py-2 rounded text-sm">
        Config
      </a>
      <button hx-post="/api/streams/{{ stream.id }}/restart"
              hx-target="#stream-{{ stream.id }}-status"
              hx-swap="innerHTML"
              class="bg-zinc-700 hover:bg-zinc-600 px-3 py-2 rounded text-sm"
              title="Restart">
        âŸ³
      </button>
    </div>
  </div>
</div>
```

---

### Stream Detail Page (`/streams/{id}`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚   â† Back    Harvard Peregrine Cam                     ğŸŸ¢ Running    âŸ³  â¹    â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚                                             â”‚  â”‚                       â”‚â”‚
â”‚   â”‚                                             â”‚  â”‚  EVENTS - Dec 27      â”‚â”‚
â”‚   â”‚                                             â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”‚
â”‚   â”‚              [Video Player]                 â”‚  â”‚                       â”‚â”‚
â”‚   â”‚              (640x360 or larger)            â”‚  â”‚  07:23  ğŸ”µ Arrival    â”‚â”‚
â”‚   â”‚                                             â”‚  â”‚  07:45  ğŸ”´ Departure  â”‚â”‚
â”‚   â”‚                                             â”‚  â”‚  09:12  ğŸ”µ Arrival    â”‚â”‚
â”‚   â”‚                                             â”‚  â”‚  09:14  ğŸŸ¡ Activity   â”‚â”‚
â”‚   â”‚                                             â”‚  â”‚  11:30  ğŸ”´ Departure  â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  ...                  â”‚â”‚
â”‚                                                    â”‚                       â”‚â”‚
â”‚   â—€ Dec 26  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Dec 27 â–¶  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”‚
â”‚   â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚  [ğŸ”´ Watch Live]      â”‚â”‚
â”‚   ~~~~~~^                                          â”‚                       â”‚â”‚
â”‚     [7:23 AM - Arrival - 22min visit]              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚   RECENT CLIPS                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  arr   â”‚ â”‚  dep   â”‚ â”‚  arr   â”‚ â”‚ visit  â”‚ â”‚  arr   â”‚ â”‚  dep   â”‚        â”‚
â”‚   â”‚ 07:23  â”‚ â”‚ 07:45  â”‚ â”‚ 09:12  â”‚ â”‚ 09:12  â”‚ â”‚ 11:30  â”‚ â”‚ 11:45  â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚   â”‚ âš™ Config â”‚  â”‚ ğŸ“‹ Logs  â”‚  â”‚ ğŸ“ Files â”‚                                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Interactions:**

1. **Timeline bar** - Click to jump to time, shows tooltip on hover
2. **Event list** - Click event to load clip in player
3. **Day navigation** - Arrows load previous/next day
4. **Clip thumbnails** - Click to play in video player
5. **Watch Live** - Opens YouTube embed in player
6. **Restart/Stop** - HTMX buttons update status

---

### Config Editor Page (`/streams/{id}/config`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚   â† Back to Harvard                                                          â”‚
â”‚                                                                              â”‚
â”‚   STREAM CONFIGURATION                                                       â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚   Stream & Detection                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  video_source                                                        â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚  â”‚ https://www.youtube.com/watch?v=glczTFRRAK4                    â”‚  â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  detection_confidence              frame_interval                    â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚   â”‚  â”‚ [====â—=====] 0.50       â”‚      â”‚ 3                       â”‚       â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚   â”‚  0.0 = everything, 1.0 = certain   Process every Nth frame          â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  timezone                                                            â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚  â”‚
â”‚   â”‚  â”‚ -05:00 (EST)        â–¼   â”‚                                        â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚   State Machine Thresholds                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  exit_timeout                      roosting_threshold                â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚   â”‚  â”‚ 300                     â”‚ sec  â”‚ 1800                    â”‚ sec   â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚   â”‚  = 5 min                          = 30 min                          â”‚  â”‚
â”‚   â”‚  Time without detection before    Presence time before falcon       â”‚  â”‚
â”‚   â”‚  declaring departure              is considered "roosting"          â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  roosting_exit_timeout             activity_timeout                  â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚   â”‚  â”‚ 600                     â”‚ sec  â”‚ 180                     â”‚ sec   â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚   â”‚  = 10 min                         = 3 min                           â”‚  â”‚
â”‚   â”‚  Exit timeout when roosting       Activity detection window         â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  âš ï¸  Constraints:                                                    â”‚  â”‚
â”‚   â”‚  â€¢ activity_timeout (180) < roosting_exit_timeout (600) âœ“           â”‚  â”‚
â”‚   â”‚  â€¢ exit_timeout (300) < roosting_exit_timeout (600) âœ“               â”‚  â”‚
â”‚   â”‚  â€¢ roosting_threshold (1800) > exit_timeout (300) âœ“                 â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚   Clip Extraction                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  clip_arrival_before    clip_arrival_after                           â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
â”‚   â”‚  â”‚ 15           â”‚ sec  â”‚ 30           â”‚ sec                         â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  clip_departure_before  clip_departure_after                         â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
â”‚   â”‚  â”‚ 30           â”‚ sec  â”‚ 15           â”‚ sec                         â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  clip_crf (quality)    clip_fps                                     â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
â”‚   â”‚  â”‚ 23           â”‚      â”‚ 30           â”‚                             â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
â”‚   â”‚  18=high, 23=balanced, 28=small                                     â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚   Notifications                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  [âœ“] telegram_enabled                                                â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  telegram_channel                                                    â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚  â”‚ @kanyo_harvard_falcon_cam                                      â”‚  â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  notification_cooldown_minutes                                       â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚  â”‚
â”‚   â”‚  â”‚ 5            â”‚ min                                               â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ View Raw YAML     â”‚                    â”‚   Cancel    â”‚ â”‚    Save     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                            â”‚ Save & Restart Stream       â”‚  â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Config Form Behavior:**

1. **Validation** runs on change (via HTMX) showing constraint violations
2. **Save** writes config.yaml without restarting
3. **Save & Restart** writes config and triggers container restart
4. **Cancel** returns to detail page without saving
5. **View Raw YAML** shows/hides raw config file

---

### Logs Page (`/streams/{id}/logs`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚   â† Back to Harvard                                           [Clear] [âŸ³]   â”‚
â”‚                                                                              â”‚
â”‚   LOGS                                                                       â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚   Filter: [All â–¼]  Level: [INFO â–¼]  Search: [________________] [ğŸ”]         â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ 2025-12-27 07:23:15 INFO  State: ABSENT â†’ VISITING                   â”‚  â”‚
â”‚   â”‚ 2025-12-27 07:23:15 INFO  ğŸ”µ Falcon arrived                          â”‚  â”‚
â”‚   â”‚ 2025-12-27 07:23:16 INFO  Creating arrival clip...                   â”‚  â”‚
â”‚   â”‚ 2025-12-27 07:23:18 INFO  Clip saved: falcon_072315_arrival.mp4      â”‚  â”‚
â”‚   â”‚ 2025-12-27 07:23:18 INFO  Sending Telegram notification...           â”‚  â”‚
â”‚   â”‚ 2025-12-27 07:23:19 INFO  Notification sent successfully             â”‚  â”‚
â”‚   â”‚ 2025-12-27 07:45:30 INFO  State: VISITING â†’ ABSENT                   â”‚  â”‚
â”‚   â”‚ 2025-12-27 07:45:30 INFO  ğŸ”´ Falcon departed (visit: 22m 15s)        â”‚  â”‚
â”‚   â”‚ 2025-12-27 07:45:31 INFO  Creating departure clip...                 â”‚  â”‚
â”‚   â”‚ 2025-12-27 07:45:33 INFO  Clip saved: falcon_074530_departure.mp4    â”‚  â”‚
â”‚   â”‚ ...                                                                  â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚                                                                  â–¼   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚   [âœ“] Auto-scroll    [âœ“] Live updates                   Showing 100 lines   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Log Viewer Features:**

1. **Live tail** via WebSocket (optional, checkbox to enable)
2. **Level filter** - DEBUG, INFO, WARNING, ERROR
3. **Search** - Filter lines containing text
4. **Auto-scroll** - Follow new lines
5. **Color coding** - Different colors for log levels

---

## Part 4: API Specification

### Stream Endpoints

```
GET  /api/streams
     â†’ List all streams with status and summary

GET  /api/streams/{id}
     â†’ Stream detail with full config and stats

PUT  /api/streams/{id}/config
     Body: { config: {...} }
     â†’ Update config.yaml, returns validation result

POST /api/streams/{id}/restart
     â†’ Restart container, returns new status

POST /api/streams/{id}/stop
     â†’ Stop container

POST /api/streams/{id}/start
     â†’ Start container
```

### Clip Endpoints

```
GET  /api/streams/{id}/clips
     Query: ?date=2025-12-27
     â†’ List clips for date

GET  /api/streams/{id}/clips/{date}/{filename}
     â†’ Serve clip file (video or image)

GET  /api/streams/{id}/thumbnail
     â†’ Latest thumbnail (most recent clip image)
```

### Event Endpoints

```
GET  /api/streams/{id}/events
     Query: ?date=2025-12-27
     â†’ Events for timeline

GET  /api/streams/{id}/timeline
     Query: ?date=2025-12-27
     â†’ Pre-computed timeline segments
```

### Log Endpoints

```
GET  /api/streams/{id}/logs
     Query: ?lines=100&level=INFO
     â†’ Recent log lines

WS   /api/streams/{id}/logs/stream
     â†’ WebSocket for live log tail
```

### System Endpoints

```
GET  /api/system/status
     â†’ GPU info, disk usage, container stats

GET  /api/system/health
     â†’ Health check for monitoring
```

---

## Part 5: Service Layer Design

### DockerService

```python
# services/docker_service.py
import docker
from typing import Optional

class DockerService:
    def __init__(self):
        self.client = docker.from_env()
    
    def get_container_status(self, container_name: str) -> dict:
        """Get container status and stats."""
        try:
            container = self.client.containers.get(container_name)
            return {
                "status": container.status,  # running, exited, paused
                "id": container.short_id,
                "uptime": self._calculate_uptime(container),
                "stats": self._get_stats(container)
            }
        except docker.errors.NotFound:
            return {"status": "not_found"}
    
    def restart_container(self, container_name: str) -> bool:
        """Restart a container."""
        container = self.client.containers.get(container_name)
        container.restart(timeout=30)
        return True
    
    def stop_container(self, container_name: str) -> bool:
        """Stop a container."""
        container = self.client.containers.get(container_name)
        container.stop(timeout=30)
        return True
    
    def start_container(self, container_name: str) -> bool:
        """Start a stopped container."""
        container = self.client.containers.get(container_name)
        container.start()
        return True
    
    def get_gpu_info(self) -> Optional[dict]:
        """Get NVIDIA GPU info if available."""
        # Run nvidia-smi in a container or on host
        pass
```

### ConfigService

```python
# services/config_service.py
import yaml
from pathlib import Path
from typing import Any

class ConfigService:
    def __init__(self, base_path: Path):
        self.base_path = base_path
    
    def read_config(self, stream_id: str) -> dict[str, Any]:
        """Read stream config.yaml."""
        config_path = self.base_path / stream_id / "config.yaml"
        with open(config_path) as f:
            return yaml.safe_load(f)
    
    def write_config(self, stream_id: str, config: dict[str, Any]) -> None:
        """Write stream config.yaml."""
        # Validate first
        self.validate_config(config)
        
        config_path = self.base_path / stream_id / "config.yaml"
        with open(config_path, 'w') as f:
            yaml.dump(config, f, default_flow_style=False)
    
    def validate_config(self, config: dict[str, Any]) -> list[str]:
        """Validate config, return list of errors."""
        errors = []
        
        # Required fields
        if not config.get("video_source"):
            errors.append("video_source is required")
        
        # Timing constraints
        exit_timeout = config.get("exit_timeout", 300)
        roosting_threshold = config.get("roosting_threshold", 1800)
        roosting_exit_timeout = config.get("roosting_exit_timeout", 600)
        activity_timeout = config.get("activity_timeout", 180)
        
        if activity_timeout >= roosting_exit_timeout:
            errors.append(
                f"activity_timeout ({activity_timeout}) must be < "
                f"roosting_exit_timeout ({roosting_exit_timeout})"
            )
        
        if exit_timeout >= roosting_exit_timeout:
            errors.append(
                f"exit_timeout ({exit_timeout}) must be < "
                f"roosting_exit_timeout ({roosting_exit_timeout})"
            )
        
        if roosting_threshold <= exit_timeout:
            errors.append(
                f"roosting_threshold ({roosting_threshold}) must be > "
                f"exit_timeout ({exit_timeout})"
            )
        
        return errors
```

### ClipService

```python
# services/clip_service.py
from pathlib import Path
from datetime import datetime
import re

class ClipService:
    def __init__(self, base_path: Path):
        self.base_path = base_path
    
    def list_clips(self, stream_id: str, date: str) -> list[dict]:
        """List clips for a stream on a given date."""
        clips_dir = self.base_path / stream_id / "clips" / date
        
        if not clips_dir.exists():
            return []
        
        clips = []
        for f in sorted(clips_dir.iterdir()):
            if f.suffix in ('.mp4', '.jpg'):
                clip_info = self._parse_filename(f)
                if clip_info:
                    clips.append(clip_info)
        
        return clips
    
    def _parse_filename(self, path: Path) -> dict | None:
        """Parse clip filename into metadata.
        
        Format: falcon_HHMMSS_type.ext
        Example: falcon_072315_arrival.mp4
        """
        pattern = r"falcon_(\d{6})_(\w+)\.(mp4|jpg)"
        match = re.match(pattern, path.name)
        
        if not match:
            return None
        
        time_str, event_type, ext = match.groups()
        
        return {
            "filename": path.name,
            "time": f"{time_str[:2]}:{time_str[2:4]}:{time_str[4:6]}",
            "type": event_type,
            "is_video": ext == "mp4",
            "size_bytes": path.stat().st_size,
            "path": str(path)
        }
    
    def get_latest_thumbnail(self, stream_id: str) -> Path | None:
        """Get most recent thumbnail image."""
        clips_dir = self.base_path / stream_id / "clips"
        
        # Find most recent date folder
        date_dirs = sorted(clips_dir.iterdir(), reverse=True)
        
        for date_dir in date_dirs:
            # Find most recent .jpg
            jpgs = sorted(date_dir.glob("*.jpg"), reverse=True)
            if jpgs:
                return jpgs[0]
        
        return None
```

---

## Part 6: Implementation Steps

### Step 1: Project Setup (30 min)

```bash
# On shingan.lan
cd /opt/services/kanyo-admin
mkdir -p web/app/{routers,services,templates/components,static/{css,js}}

# Create requirements.txt
cat > web/requirements.txt << 'EOF'
fastapi==0.109.0
uvicorn[standard]==0.27.0
jinja2==3.1.3
python-multipart==0.0.6
pyyaml==6.0.1
docker==7.0.0
aiofiles==23.2.1
websockets==12.0
EOF

# Create Dockerfile
cat > web/Dockerfile << 'EOF'
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY app/ ./app/
COPY streams.yaml .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "5000"]
EOF
```

### Step 2: FastAPI App Skeleton (30 min)

Create the main app with routing structure.

### Step 3: Services (45 min)

Implement DockerService, ConfigService, ClipService.

### Step 4: API Routes (30 min)

Implement JSON API endpoints.

### Step 5: Templates (60 min)

Build Jinja2 templates with HTMX.

### Step 6: Integration (30 min)

Update docker-compose.yml, test deployment.

---

## Part 7: Docker Compose Integration

```yaml
# Add to kanyo-admin/docker-compose.yml
services:
  admin:
    build: ./web
    container_name: kanyo-admin-web
    ports:
      - "5000:5000"
    volumes:
      # Docker socket for container management
      - /var/run/docker.sock:/var/run/docker.sock
      
      # Stream data directories
      - ${KANYO_HARVARD_ROOT:-/opt/services/kanyo-harvard}:/data/harvard
      - ${KANYO_NSW_ROOT:-/opt/services/kanyo-nsw}:/data/nsw
      
      # For development: mount source
      # - ./web/app:/app/app:ro
      # - ./web/streams.yaml:/app/streams.yaml:ro
    environment:
      - KANYO_ENV=production
      - KANYO_DATA_PATH=/data
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Existing services unchanged...
  harvard-gpu:
    # ...
  
  nsw-gpu:
    # ...
```

---

## Part 8: Success Criteria

### Minimum Viable (This Ho)

- [ ] Admin container builds and runs
- [ ] Overview page shows all streams with status
- [ ] Can click into stream detail
- [ ] Can view recent clips
- [ ] Can restart a stream from UI
- [ ] Can view logs (last 100 lines)

### Complete (Stretch)

- [ ] Config editor with validation
- [ ] Live log streaming
- [ ] Timeline bar on detail page
- [ ] GPU stats displayed
- [ ] Add stream functionality

---

## Part 9: Testing Plan

### Manual Testing Checklist

1. **Overview Page**
    
    - [ ] Shows Harvard and NSW streams
    - [ ] Status indicators match `docker ps`
    - [ ] Thumbnails load (if clips exist)
    - [ ] Click "View" goes to detail page
2. **Stream Detail**
    
    - [ ] Shows stream info
    - [ ] Lists recent clips
    - [ ] Video plays when clicked
    - [ ] Events list populates
3. **Config Editor**
    
    - [ ] Loads current config values
    - [ ] Validation shows errors for bad values
    - [ ] Save writes file correctly
    - [ ] Save & Restart triggers container restart
4. **Container Operations**
    
    - [ ] Restart button restarts container
    - [ ] Status updates after restart
    - [ ] Stop button stops container
    - [ ] Start button starts stopped container
5. **Logs**
    
    - [ ] Shows recent log lines
    - [ ] Filter by level works
    - [ ] Search works

---

## Appendix: Code Templates

### Base Template

```html
<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Kanyo Admin{% endblock %}</title>
  
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            zinc: {
              850: '#1f1f23',
            }
          }
        }
      }
    }
  </script>
  
  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  
  <!-- Custom styles -->
  <link rel="stylesheet" href="/static/css/custom.css">
</head>
<body class="bg-zinc-900 text-white min-h-screen">
  {% block content %}{% endblock %}
  
  <!-- Custom scripts -->
  <script src="/static/js/app.js"></script>
</body>
</html>
```

### Main App

```python
# app/main.py
from fastapi import FastAPI, Request
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates

from app.routers import api, pages
from app.config import settings

app = FastAPI(title="Kanyo Admin", version="0.1.0")

# Static files
app.mount("/static", StaticFiles(directory="app/static"), name="static")

# Templates
templates = Jinja2Templates(directory="app/templates")

# Include routers
app.include_router(api.router, prefix="/api")
app.include_router(pages.router)

@app.get("/health")
async def health():
    return {"status": "ok"}
```

---

## Next Steps

After completing Ho 6.1:

1. **Ho 6.2** - Add HKSV-style timeline component
2. **Ho 6.3** - Build React viewer for public deployment
3. **Ho 6.4** - Cloudflare R2 sync and Pages deployment

---

_Document created: 2025-12-27_ _Ready for implementation_