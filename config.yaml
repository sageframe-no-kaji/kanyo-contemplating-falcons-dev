# Kanyo configuration
# Override any value with env var: KANYO_<KEY> (e.g., KANYO_VIDEO_SOURCE)

# ─────────────────────────────────────────────────────────────────────────────
# Stream & Detection
# ─────────────────────────────────────────────────────────────────────────────
video_source: "https://www.youtube.com/watch?v=yv2RtoIMNzA"  # NSW falcon cam
detection_confidence: 0.5      # 0.0–1.0, higher = fewer false positives
frame_interval: 3              # process every 3rd frame (~10fps detection at 30fps source)
model_path: "models/yolov8n.pt"
detect_any_animal: true        # treat any animal as "falcon" (model misclassifies)

# State machine configuration for roosting detection
exit_timeout: 300              # 5 min - mark departed if absent this long during visit
roosting_threshold: 1800       # 30 min - transition to roosting state
roosting_exit_timeout: 600     # 10 min - must be absent this long when roosting
activity_timeout: 180          # 3 min - brief absence during roost is activity
activity_notification: false   # Send notifications for activity events?
visit_merge_timeout: 60        # merge visits if re-enter within N seconds (debounce)

# COCO class IDs to detect when detect_any_animal is true
# Model often misclassifies falcons as: bird(14), cat(15), dog(16)
animal_classes:
  - 14  # bird
  - 15  # cat
  - 16  # dog
  - 17  # horse
  - 18  # sheep
  - 19  # cow
  - 20  # elephant
  - 21  # bear
  - 22  # zebra
  - 23  # giraffe

# ─────────────────────────────────────────────────────────────────────────────
# Clip Extraction & Storage
# ─────────────────────────────────────────────────────────────────────────────
clips_dir: "clips"             # where to save clips and thumbnails (organized by date)
clip_entrance_before: 5       # seconds before entrance to include
clip_entrance_after: 15        # seconds after entrance to include
clip_exit_before: 15           # seconds before exit to include
clip_exit_after: 5            # seconds after exit to include
clip_merge_threshold: 180      # merge into one clip if events within N seconds

# Thumbnail settings (one per event)
thumbnail_entrance_offset: 5   # seconds after entrance to capture thumbnail
thumbnail_exit_offset: -10     # seconds before exit (negative = before event)

# Compression settings
clip_compress: true            # re-encode for smaller files (~10x smaller)
clip_crf: 23                   # quality: 18=high/larger, 23=balanced, 28=low/smaller
clip_fps: 30                   # output framerate (30 is fine for playback)

# Hardware encoding (GPU acceleration) - see docs/hardware-encoding.md
clip_hardware_encoding: true   # true=auto-detect GPU, false=use software (libx264)
# clip_encoder: auto           # override: h264_videotoolbox, h264_nvenc, h264_vaapi, libx264

# ─────────────────────────────────────────────────────────────────────────────
# Live Stream Ingestion (YouTube)
# ─────────────────────────────────────────────────────────────────────────────
live_use_ffmpeg_tee: true      # use ffmpeg tee to proxy+record YouTube live streams
live_proxy_url: "udp://127.0.0.1:12345"  # local proxy URL for detection
buffer_dir: "/tmp/kanyo-buffer"  # where segment recorder writes rolling buffer
continuous_chunk_minutes: 10   # segment duration for rolling buffer (minutes)

# ─────────────────────────────────────────────────────────────────────────────
# Logging
# ─────────────────────────────────────────────────────────────────────────────
log_level: "INFO"              # DEBUG, INFO, WARNING, ERROR, CRITICAL
log_file: "logs/kanyo.log"

# ─────────────────────────────────────────────────────────────────────────────
# Notifications
# ─────────────────────────────────────────────────────────────────────────────
# Enable/disable Telegram public alerts (falcon arrivals/departures with images)
telegram_enabled: true

# Enable/disable ntfy admin error notifications (system errors, text only)
ntfy_admin_enabled: true

# Cooldown applies to arrival notifications only (departure always sent)
notification_cooldown_minutes: 5

# Credentials are in .env file:
#   TELEGRAM_BOT_TOKEN - Bot authentication token
#   TELEGRAM_CHANNEL - Channel ID or @username (public alerts with images)
#   NTFY_ADMIN_TOPIC - Topic for admin/error notifications (text only)
